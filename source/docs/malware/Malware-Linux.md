# Linux malware

## Attack tree

```text
1 Create backdoor (AND)
    1.1 Metasploit meterpreter
        1.1.1 Reverse https payload        
            1.1.1.1 With Veil (OR)
                1.1.1.1.1 Choose payload and set options (reverse, https, lhost, lport) (AND)
                1.1.1.1.2 Generate (AND)
            1.1.1.2 With TheFatRat (OR)
                1.1.1.2.1 Trojan Debian Package For remote access
                    1.1.1.2.1.1 Trodebi
        1.1.2 Check it is not detected by AV
        1.1.3 Start listener using Metasploit (AND)
            1.1.3.1 Use exploit/multi/handler (AND)
            1.1.3.2 Set PAYLOAD (reverse, https, lhost, lport) (AND)
            1.1.3.3 Exploit
    1.2 Powershell stager
        1.2.1 Powershell-empire server (AND)
        1.2.2 Powershell-empire client (AND)
            1.2.2.1 Create listener (uselistener/http) and set Port (AND)
            1.2.2.3 Generate (AND)
            1.2.2.3 Create stager (usestager multi/bash) and set Listener to just created listener (AND)
            1.2.2.4 Generate
        1.2.3 Check it is not detected by AV
2 Deliver payload (start server) (AND)
    2.1 start apache2 on kali (service apache2 start) (AND)
    2.2 put payload in /var/www/html/evil-files (create dir) (AND)
    2.3 Deliver
        2.3.1 Nothing smart, just to test it works - Download from a machine in the network (OR)
        2.3.2 A little smarter, using BeEF - Fake notification bar
        2.3.3 ...
3 Post exploitation
```

## Notes

### Linux Trojans

Problems: Executables donâ€™t run by double clickand users have to manually change file permission to executable.

Solution :
* Embed evil code in an executable package.
* Use a legitimate app to make the trojan less suspicious.
* One that runs by doubleclicking with root (admin) privileges.

## Tools

* [Install veil for kali](https://github.com/Veil-Framework/Veil/)
* [GitHub TheFatRat](https://github.com/Exploit-install/TheFatRat)
* [Empire on Kali](https://www.kali.org/tools/powershell-empire/)
* [Github Empire 4](https://github.com/BC-SECURITY/Empire)
* [Metasploit](https://www.kali.org/docs/tools/starting-metasploit-framework-in-kali/)
* [BeEF XSS](https://www.kali.org/tools/beef-xss/)

## Troubleshooting

* [Veil Installation error Failed to run (wine) Python pip pefile... Exit code: 1](../trouble/Veil.md)
* [Empire cannot import name 'Mapping' from 'collections'](../trouble/Empire.md)

## Cheatsheets

* [Empire wiki](https://bc-security.gitbook.io/empire-wiki/)
* [Why use meterpreter](https://www.offensive-security.com/metasploit-unleashed/about-meterpreter/#Meterpreter_Design_Goals)

## Scripts

* [Nirridit (Evil files)](https://github.com/tymyrddin/nirridit)
* [Ymrir (Network hacking scripts)](https://github.com/tymyrddin/ymrir)