# Command and control (C&C)

## Attack tree

```text
1 C&C infrastructure
    1.1 Move laterally
    1.2 Mount multi-stage attacks
    1.3 Exfiltrate data
    1.4 Mount DDoS
    1.5 Run a botnet
    1.6 Run crypto mining botnets
    1.7 ...
```

## Notes

With a foot into the door, maintain persistence within the target environment, communicate with 
infected or compromised devices inside the network, and potentially exfiltrate sensitive data.

Like the previous malware trail, but now on steroids: Using Command and Control Infrastructures or "C2"'s for 
communication with compromised systems.

### Centralised C2

With a centralised command and control model, a malware “client” will phone home to a C2 server and check for 
instructions. The server-side infrastructure can include redirectors, load balancers, and defense measures to detect 
security researchers and law enforcement. Public cloud services and Content Delivery Networks (CDNs) are often used to 
host or mask activity.

The domains and servers can be removed within hours of their first use, and the malware is often coded with a list of 
different C2 servers to try and reach.

### P2P C2

In a P2P C2 model, command and control instructions are delivered to members of a botnet relaying messages between one 
another. Some nodes can function as server, but there is no central or master node. This makes it harder to detect or 
disrupt than a centralised model but can also make it more difficult to issue instructions to the entire botnet. 

P2P networks can be used as a fallback mechanism in case the primary centralised C2 channel is disrupted.

### Out of Band

Twitter, Gmail, IRC chat rooms, and even Pinterest can be used to issue C&C messages to compromised hosts.

### Random

Command and control infrastructure can even be random, and use scanning the Internet to find an infected host. This is 
extremely hard to take down.

## C2 Frameworks

* [Cobaltstrike](https://www.cobaltstrike.com/)
* [Covenant](https://github.com/cobbr/Covenant/)
* [Sillenttrinity](https://github.com/byt3bl33d3r/SILENTTRINITY)
* [Koadic](https://github.com/zerosum0x0/koadic)
* [Metasploit](https://www.metasploit.com/)
* [Merlin](https://github.com/Ne0nd0g/merlin) <=

## Articles

* [MITRE | ATT&CK Command and Control](https://attack.mitre.org/tactics/TA0011/)
* [Using Merlin agents to evade detection](https://resources.infosecinstitute.com/topic/using-merlin-agents-to-evade-detection/)